{% extends "base.html" %}
{% load static %}

{% block title %}DashBoard Peixes{% endblock title %}



{% block content %}

<div id="wrapper">  
    <!-- Sidebar -->
            <!-- Sidebar -->
    
          
    <!-- Page content -->
    <div id="page-content-wrapper">
        <!-- Keep all page content within the page-content inset div! -->
        <div class="page-content inset">
          <div class="row">
          {% if perms.peixes.can_view_projeto %}
            {% if num_projetos %}    
            <h3 class="page-header">Projeto Atual: 
              <small>
                <select class="projetoss"> 
                {% for pro in projetos%}
                  <option value="{{pro.id}}">{{pro.nome}}</option>
                {% endfor %}
                </select>
              </small>
            </h3>
            {% else%}
              <h3 class="page-header">Nao tem nenhum projeto!.</h3>
            {% endif %}
          </div>
          <div class="row">
            {% if not num_projetos %}
              {% if perms.peixes.can_add_projeto %}
                Crie um projeto agora <a href="{% url 'new_projeto' %}"><button type="button" class="btn btn-info">Criar</button></a>
              {% endif %}
            {% else %}
                
            {% endif %}
            <div class="pull-right">
              <a href="{% url 'list_projetos' %}"><button type="button" class="btn btn-success">Ver todos os projetos</button></a>
            </div>
          </div>

            <div class="row">
              <h3 class="page-header">Integrantes do Projeto</h3>
            </div>
            <div class="row">
              <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>Autorização</th>
                                            <th>Stuff</th>
                                        </tr>
                                    </thead>
                                    <tbody  id="result">
                                     {% for int in integrantes %}
                                        <tr>
                                            <td>{{int.user.username}}</td>
                                            <td>
                                                {% for g in int.user.groups.all %}
                                                  {{g.name}}
                                                {% endfor%}
                                            </td>
                                            <td>Wi</td>
                                        </tr> 
                                      {% endfor %}
                                    </tbody>
                                </table>
              </div>
            </div>

            <!-- <a href=""><button type="button" class="btn btn-default">Adiciona usuario</button></a>
            <a href=""><button type="button" class="btn btn-default">Remove usuario</button></a> -->

              <div class="row">
                <h3 class="page-header">Petições</h3>
              </div>
              <div class="row">

                <!-- <a href="{% url 'pinax_messages:inbox' %}"><i class="fa fa-envelope"></i>Message Inbox</a> -->
                

              <div class="pull-right">
                <a href=""><button type="button" class="btn btn-success">Visualizar</button></a>
              </div>
            </div>
              
            
          </div>
          {% else %}
            <h3 class="page-header">Nao pertence a nenhum projeto!.</h3>
            {{request.user.get_all_permissions}}
            <div class="pull-right">
              <a href="{% url 'list_projetos' %}"><button type="button" class="btn btn-success">Ver todos os projetos</button></a>
            </div>
          {% endif%}
            
        </div>
      
      
</div>
<script src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
<script>
  $(document).ready(function () {
      $('.projetoss').on('change', function (e) {
      var slug = $(".projetoss").val();
      console.log(slug);
      var url_mask = "{% url 'update_consulta_integrantes' slug=12345 %}".replace(/12345/, slug.toString());
      $.ajax({
        url: url_mask,
        dataType: 'json',
        success: function (data) {

          var users = data.users;
          var usersGroups = data.usersGroups;
          console.log(usersGroups);
          console.log(users);
          $( "#result" ).empty();
          // $.each(users, function(index, value){
          //   $("#result").append('<tr><td>'+ users[0][1] +'</td></tr>');
          //   for(var i = 0; i<usersGroups.length;i++){
          //       if(users[i][0] == usersGroups[i][0] ){
          //         $("#result").append('<tr><td>'+ usersGroups[i][1] +',</td></tr>');
          //       }
          //       // $("#result").append('<tr><td>'+ usersGroups[i][1] +'</td><td>'+ value[1] +'</td></tr>');
          //   }
            
          //   // console.log(value.id_user);
          // });

          for(var i = 0; i<users.length;i++){
            $("#result").append('<tr><td>'+ users[i][0][1] +'</td></tr>');
                // $("#result").append('<tr><td>'+ usersGroups[i][1] +'</td><td>'+ value[1] +'</td></tr>');


              // for(var i = 0; i<usersGroups.length;i++){
              //   if(users[i][0][0] == usersGroups[i][0][0] ){
              //     $("#result").append('<tr><td>'+ usersGroups[i][0][1] +',</td></tr>');
              //   }


              //   // $("#result").append('<tr><td>'+ usersGroups[i][1] +'</td><td>'+ value[1] +'</td></tr>');
              // }
            }


        }

      });

      });
      
  });
  </script>

{% endblock %}
